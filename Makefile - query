CXXFLAGS = -g -Wall -DDEBUG -I.

all: test-query
	:

test-query: test-query.o
	$(CXX) $(CXXFLAGS) -o test-query test-query.o

test-query.o: test-query.cc clone.h debug.h query.h 
	$(CXX) $(CXXFLAGS) -c test-query.cc



test: test-query
	@set -e; PATH="$$PATH:.";             \
	for t in test-*-[1-9]; do             \
	  echo testing: $$t.;                 \
	  $$t <$$t.in >$$t.t;                 \
	  diff $$t.ref $$t.t >/dev/null 2>&1; \
	done
	@echo test ok.

test-valgrind: test-query
	@set -e; PATH="$$PATH:.";                                  \
	for t in test-*-[1-9]; do                                  \
	  echo testing: $$t.;                                      \
	  valgrind --tool=memcheck $$t <$$t.in >$$t.t 2>/dev/null; \
	  diff $$t.ref $$t.t >/dev/null 2>&1;                      \
	done
	@echo test ok.

clean:
	rm -f *.o *.t core test-*-[1-9]
